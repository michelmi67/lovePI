<!DOCTYPE html>
<html>
<head>
  <title>Paiement Pi Test - Debug Final</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <script>
    alert("JS chargé");

    document.addEventListener("DOMContentLoaded", function () {
      alert("DOMContentLoaded");

      if (!window.Pi) {
        alert("Pi SDK non dispo");
        return;
      }
      alert("Pi SDK trouvé !");

      Pi.init({ version: "2.0" });

      let authTimeout = setTimeout(() => {
        alert("Callback Pi.authenticate jamais reçu après 15 secondes !");
      }, 15000);

      Pi.authenticate(['username', 'payments'], { sandbox: true }, function (auth) {
        clearTimeout(authTimeout);
        alert("Authentifié Pi ! (utilisateur : " + auth.user.username + ")");
        const btn = document.getElementById('pay-btn');
        btn.disabled = false;

        btn.onclick = function () {
          alert("Tentative paiement");
          Pi.createPayment({
            amount: 0.01,
            memo: "Test Pi",
            metadata: { test: true }
          }, {
            onReadyForServerApproval(paymentId) {
              alert("En attente validation serveur : " + paymentId);
            },
            onReadyForServerCompletion(paymentId, txid) {
              alert("Paiement terminé ! " + paymentId + " / tx: " + txid);
            },
            onCancel(paymentId) {
              alert("Paiement annulé : " + paymentId);
            },
            onError(e) {
              alert("Erreur: " + JSON.stringify(e));
            }
          });
        };
      });
    });
  </script>
</head>
<body>
  <button id="pay-btn" disabled>Payer 0.01 Pi</button>
</body>
</html>
